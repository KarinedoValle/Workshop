@model Usuario
@{
    ViewData["Title"] = "Editar Usuario";
}

<div class="text-center">
    <h1 class="display-4">Editar Usuário</h1>
</div>

<form id="cadastroForm" asp-action="Usuario" method="get" asp-controller="Usuario">
    <input type="hidden" asp-for="Cpf" />
    @Html.Partial("_UsuarioForm", Model)
</form> 

@section Scripts {
    <script>

        function submitForm() {
            const formData = {

                Nome: checkField(document.getElementById('Nome')),
                CPF: '@Model.Cpf',
                Telefone: checkField(document.getElementById('Telefone')),
                Email: checkField(document.getElementById('Email')),
                Login: checkField(document.getElementById('Login')),
                Senha: checkField(document.getElementById('Senha')),
                Perfil: checkField(document.getElementById('Perfil'))
            };

            fetch('/api/Usuario/@Model.Cpf', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            }).then(response =>{
                if (!response.ok) {
                    const contentType = response.headers.get('Content-Type');
                    if (contentType && contentType.includes('application/problem+json; charset=utf-8')){
                        return response.json().then(errorData => {
                            const erros = errorData.errors;
                            const mensagens = [];

                            for (let campo in erros) {
                                mensagens.push(erros[campo][0]);
                            }

                            alert(mensagens.join('\n'));
                            throw new Error(mensagens.join('\n'));
                        }); 
                    }
                    response.text().then(errorText => {
                            alert(`${errorText}`);
                            throw new Error(errorText);
                    });
                    throw new Error("Erro");
                }
            })
            .then(data => {
                window.location.href = '/Usuario/Usuarios';
            })
            .catch(error => console.error('Erro:', error));
        }
    </script>
}